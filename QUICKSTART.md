# Быстрый старт

## Установка и настройка

1. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

2. **Создайте файл `.env` из примера:**
```bash
cp .env.example .env
```

3. **Заполните `.env` файл:**
   - `BOT_TOKEN` - получите у @BotFather в Telegram
   - `ADMIN_USER_IDS` - ID администраторов через запятую (можно узнать через бота @userinfobot)

4. **Создайте необходимые директории:**
```bash
mkdir -p data uploads temp
```

5. **Запустите бота:**
```bash
python main.py
```

## Получение токена бота

1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен в файл `.env`

## Получение ID пользователя (для администраторов)

1. Откройте Telegram и найдите @userinfobot
2. Начните диалог с ботом
3. Скопируйте ваш ID (число)
4. Добавьте его в `ADMIN_USER_IDS` в файле `.env`

## Структура проекта

```
healthy_bot_AI/
├── main.py                 # Точка входа и планировщик задач
├── config.py              # Конфигурация из .env
├── database/              # Работа с БД
│   ├── models.py          # SQLAlchemy модели
│   └── db.py              # Подключение к БД
├── services/              # Бизнес-логика (микросервисы)
│   ├── onboarding.py      # Онбординг и анкетирование
│   ├── daily_scenarios.py # Ежедневные сценарии
│   ├── nutrition.py       # Работа с питанием
│   ├── statistics.py      # Статистика и отчёты
│   ├── admin.py           # Функции администратора
│   └── retest.py          # Повторное тестирование
├── handlers/              # Обработчики Telegram
│   ├── commands.py        # Команды (/start, /menu и т.д.)
│   ├── callbacks.py       # Callback кнопки
│   └── messages.py        # Текстовые сообщения и фото
├── utils/                 # Вспомогательные функции
│   ├── calculations.py    # Расчёты (ИМТ, калории, БЖУ)
│   ├── templates.py       # Шаблоны сообщений
│   └── validators.py      # Валидация данных
└── data/                  # База данных (создаётся автоматически)
```

## Основные команды бота

- `/start` - Начать работу / пройти анкетирование
- `/menu` - Главное меню
- `/statistics` - Просмотр статистики
- `/report` - Дневной отчёт
- `/contact_admin` - Связаться с администратором
- `/retest` - Повторное тестирование (раз в месяц)

## Автоматические функции

Бот автоматически отправляет:
- **Утром (8:00)** - приветствие и вопрос о качестве сна
- **В течение дня (10:00, 14:00, 18:00)** - напоминания о воде
- **Вечером (22:00)** - напоминание о заполнении дневного отчёта

## Особенности реализации

- MVP без ИИ - вся логика основана на правилах и формулах
- Микросервисная архитектура - каждый модуль независим
- Асинхронная работа с БД через SQLAlchemy
- Планировщик задач через APScheduler
- Поддержка опциональных вопросов в анкете
- Автоматический расчёт показателей здоровья

## Тестирование

После запуска бота:
1. Откройте Telegram и найдите вашего бота
2. Отправьте `/start`
3. Пройдите анкетирование
4. Проверьте работу всех функций через `/menu`

## Troubleshooting

**Проблема: "BOT_TOKEN not set"**
- Убедитесь, что файл `.env` существует и содержит `BOT_TOKEN`

**Проблема: "Database error"**
- Убедитесь, что директория `data/` существует и доступна для записи

**Проблема: "Module not found"**
- Установите все зависимости: `pip install -r requirements.txt`

**Бот не отвечает:**
- Проверьте логи в консоли
- Убедитесь, что токен бота правильный
- Проверьте интернет-соединение

## Миграция на aiogram

Проект полностью переписан под библиотеку **aiogram 3.4.1**. Основные изменения:
- Используется `aiogram.Router` вместо обработчиков `python-telegram-bot`
- FSM состояния определены через `StatesGroup`
- Декораторы `@router.message()` и `@router.callback_query()` для обработчиков
- Асинхронный диспетчер `Dispatcher` для управления ботом

Все функции сохранены, архитектура не изменилась.
